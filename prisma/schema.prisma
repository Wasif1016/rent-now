generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Country {
  id        String    @id @default(uuid())
  name      String
  slug      String    @unique
  code      String    @unique
  isActive  Boolean?  @default(true)
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt
  cities    City[]
}

model City {
  id                    String             @id @default(uuid())
  name                  String
  slug                  String             @unique
  province              String?
  countryId             String
  isActive              Boolean?           @default(true)
  createdAt             DateTime?          @default(now())
  updatedAt             DateTime?          @default(now()) @updatedAt
  dropoffBookings       Booking[]          @relation("BookingDropoffCity")
  pickupBookings        Booking[]          @relation("BookingPickupCity")
  country               Country            @relation(fields: [countryId], references: [id])
  routesAsDestination   Route[]            @relation("RouteDestinationCity")
  routesAsOrigin        Route[]            @relation("RouteOriginCity")
  towns                 Town[]
  vehicles              Vehicle[]
  vendors               Vendor[]
  vendorRouteOffersFrom VendorRouteOffer[] @relation("VendorRouteFromCity")
  vendorRouteOffersTo   VendorRouteOffer[] @relation("VendorRouteToCity")
}

model Town {
  id        String    @id @default(uuid())
  name      String
  slug      String
  cityId    String
  isActive  Boolean?  @default(true)
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt
  city      City      @relation(fields: [cityId], references: [id], onDelete: Cascade)
  vehicles  Vehicle[]

  @@unique([slug, cityId])
  @@index([cityId])
  @@index([slug])
}

model VehicleCategory {
  id           String        @id @default(uuid())
  name         String
  slug         String        @unique
  createdAt    DateTime?
  updatedAt    DateTime?     @updatedAt
  vehicles     Vehicle[]
  vehicleTypes VehicleType[]
}

model VehicleType {
  id            String           @id @default(uuid())
  name          String
  slug          String           @unique
  icon          String?
  description   String?
  isActive      Boolean?         @default(true)
  createdAt     DateTime?        @default(now())
  updatedAt     DateTime?        @default(now()) @updatedAt
  categoryId    String?
  vehicles      Vehicle[]
  vehicleModels VehicleModel[]
  category      VehicleCategory? @relation(fields: [categoryId], references: [id])

  @@unique([slug, categoryId])
  @@index([categoryId])
}

model VehicleBrand {
  id            String         @id @default(uuid())
  name          String
  slug          String         @unique
  logo          String?
  isActive      Boolean?       @default(true)
  createdAt     DateTime?      @default(now())
  updatedAt     DateTime?      @default(now()) @updatedAt
  vehicleModels VehicleModel[]
}

model VehicleModel {
  id                  String        @id @default(uuid())
  name                String
  slug                String        @unique
  vehicleBrandId      String
  isActive            Boolean?      @default(true)
  createdAt           DateTime?     @default(now())
  updatedAt           DateTime?     @default(now()) @updatedAt
  capacity            Int?
  bodyType            String?
  defaultColor        String?
  defaultTransmission Transmission?
  doors               Int?
  image               String?
  isPredefined        Boolean?      @default(false)
  largeBags           Int?
  vehicleTypeId       String?
  vehicles            Vehicle[]
  vehicleBrand        VehicleBrand  @relation(fields: [vehicleBrandId], references: [id])
  vehicleType         VehicleType?  @relation(fields: [vehicleTypeId], references: [id])

  @@unique([slug, vehicleBrandId])
  @@index([vehicleBrandId])
  @@index([vehicleTypeId])
  @@index([isPredefined])
}

model Vendor {
  id                         String                    @id @default(uuid())
  name                       String
  slug                       String                    @unique
  email                      String?                   @unique
  phone                      String?
  address                    String?
  supabaseUserId             String?                   @unique
  description                String?
  logo                       String?
  verificationStatus         VendorVerificationStatus? @default(PENDING)
  verifiedAt                 DateTime?
  isActive                   Boolean?                  @default(true)
  images                     Json?
  documents                  Json?
  metadata                   Json?
  createdAt                  DateTime?                 @default(now())
  updatedAt                  DateTime?                 @default(now()) @updatedAt
  personName                 String?
  whatsappPhone              String?
  accountCreatedAt           DateTime?
  emailSentAt                DateTime?
  googleMapsUrl              String?
  province                   String?
  registrationStatus         RegistrationStatus?       @default(NOT_REGISTERED)
  temporaryPasswordEncrypted String?
  town                       String?
  cityId                     String?
  bookings                   Booking[]
  inquiries                  Inquiry[]
  vehicles                   Vehicle[]
  city                       City?                     @relation(fields: [cityId], references: [id])
  vendorRouteOffers          VendorRouteOffer[]
}

model Vehicle {
  id                String             @id @default(uuid())
  vendorId          String
  vehicleModelId    String?
  cityId            String
  townId            String?
  title             String
  slug              String             @unique
  description       String?
  year              Int?
  mileage           Int?
  fuelType          FuelType?
  transmission      Transmission?
  features          Json?
  color             String?
  seats             Int?
  images            Json?
  views             Int                @default(0)
  whatsappClicks    Int                @default(0)
  callClicks        Int                @default(0)
  featured          Boolean            @default(false)
  isAvailable       Boolean?           @default(true)
  isVerified        Boolean?           @default(false)
  metadata          Json?
  createdAt         DateTime?          @default(now())
  updatedAt         DateTime?          @default(now()) @updatedAt
  vehicleTypeId     String?
  priceOutOfCity    Int?
  priceSelfDrive    Int?
  priceWithDriver   Int?
  priceWithinCity   Int?
  status            VehicleStatus      @default(PUBLISHED)
  categoryId        String?
  driverOption      DriverOption?
  seatingCapacity   Int?
  priceDaily        Int?
  priceHourly       Int?
  priceMonthly      Int?
  bookings          Booking[]
  inquiries         Inquiry[]
  category          VehicleCategory?   @relation(fields: [categoryId], references: [id])
  city              City               @relation(fields: [cityId], references: [id])
  town              Town?              @relation(fields: [townId], references: [id])
  vehicleModel      VehicleModel?      @relation(fields: [vehicleModelId], references: [id])
  vehicleType       VehicleType?       @relation(fields: [vehicleTypeId], references: [id])
  vendor            Vendor             @relation(fields: [vendorId], references: [id])
  vehicleRoutes     VehicleRoute[]
  vendorRouteOffers VendorRouteOffer[]

  @@index([cityId])
  @@index([townId])
  @@index([cityId, townId])
  @@index([isAvailable])
  @@index([vehicleTypeId])
  @@index([categoryId])
  @@index([driverOption])
  @@index([seatingCapacity])
}

model Inquiry {
  id        String         @id @default(uuid())
  vehicleId String
  vendorId  String
  userName  String
  userPhone String
  userEmail String?
  message   String?
  status    InquiryStatus? @default(PENDING)
  createdAt DateTime?      @default(now())
  updatedAt DateTime?      @default(now()) @updatedAt
  vehicle   Vehicle        @relation(fields: [vehicleId], references: [id])
  vendor    Vendor         @relation(fields: [vendorId], references: [id])

  @@index([vehicleId])
  @@index([vendorId])
  @@index([status])
}

model Booking {
  id                  String            @id @default(uuid())
  vehicleId           String
  vendorId            String
  userName            String
  userPhone           String
  userEmail           String?
  bookingDate         DateTime?
  message             String?
  status              BookingStatus     @default(PENDING)
  totalAmount         Int?
  commissionAmount    Int?
  whatsappMessageSent Boolean           @default(false)
  createdAt           DateTime?         @default(now())
  updatedAt           DateTime?         @default(now()) @updatedAt
  pickupCityId        String?
  dropoffCityId       String?
  vendorRouteOfferId  String?
  startDateTime       DateTime?
  endDateTime         DateTime?
  advanceAmount       Int?
  dropoffCity         City?             @relation("BookingDropoffCity", fields: [dropoffCityId], references: [id])
  pickupCity          City?             @relation("BookingPickupCity", fields: [pickupCityId], references: [id])
  vehicle             Vehicle           @relation(fields: [vehicleId], references: [id])
  vendor              Vendor            @relation(fields: [vendorId], references: [id])
  vendorRouteOffer    VendorRouteOffer? @relation(fields: [vendorRouteOfferId], references: [id])

  @@index([vehicleId])
  @@index([vendorId])
  @@index([status])
  @@index([createdAt])
}



model VendorRouteOffer {
  id                  String    @id @default(uuid())
  vendorId            String
  fromCityId          String
  toCityId            String
  vehicleId           String
  basePrice           Int
  instantAvailability Boolean   @default(true)
  compatibleBodyTypes Json?
  isActive            Boolean   @default(true)
  createdAt           DateTime? @default(now())
  updatedAt           DateTime? @default(now()) @updatedAt
  bookings            Booking[]
  fromCity            City      @relation("VendorRouteFromCity", fields: [fromCityId], references: [id], map: "Route_fromCityId_fkey")
  toCity              City      @relation("VendorRouteToCity", fields: [toCityId], references: [id], map: "Route_toCityId_fkey")
  vehicle             Vehicle   @relation(fields: [vehicleId], references: [id], map: "Route_vehicleId_fkey")
  vendor              Vendor    @relation(fields: [vendorId], references: [id], map: "Route_vendorId_fkey")

  @@index([fromCityId], map: "Route_fromCityId_idx")
  @@index([isActive], map: "Route_isActive_idx")
  @@index([toCityId], map: "Route_toCityId_idx")
  @@index([vehicleId], map: "Route_vehicleId_idx")
  @@index([vendorId], map: "Route_vendorId_idx")
}

model RouteType {
  id        Int      @id @default(autoincrement())
  name      String
  slug      String   @unique
  createdAt DateTime @default(now())
  routes    Route[]
}

model RouteCategory {
  id        Int      @id @default(autoincrement())
  name      String
  slug      String   @unique
  createdAt DateTime @default(now())
  routes    Route[]
}

model Route {
  id                Int            @id @default(autoincrement())
  slug              String         @unique
  originCityId      String
  destinationCityId String
  routeTypeId       Int
  routeCategoryId   Int
  distanceKm        Int?
  estimatedTime     String?
  oneWay            Boolean        @default(true)
  roundTrip         Boolean        @default(false)
  createdAt         DateTime       @default(now())
  destinationCity   City           @relation("RouteDestinationCity", fields: [destinationCityId], references: [id])
  originCity        City           @relation("RouteOriginCity", fields: [originCityId], references: [id])
  routeCategory     RouteCategory  @relation(fields: [routeCategoryId], references: [id])
  routeType         RouteType      @relation(fields: [routeTypeId], references: [id])
  vehicles          VehicleRoute[]

  @@index([originCityId, destinationCityId])
}

model VehicleRoute {
  id        Int     @id @default(autoincrement())
  vehicleId String
  routeId   Int
  route     Route   @relation(fields: [routeId], references: [id])
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id])

  @@unique([vehicleId, routeId])
  @@index([vehicleId])
  @@index([routeId])
}

model ActivityLog {
  id          String   @id @default(uuid())
  action      String
  entityType  String
  entityId    String
  adminUserId String?
  details     Json?
  createdAt   DateTime @default(now())

  @@index([entityType, entityId])
  @@index([adminUserId])
  @@index([createdAt])
  @@index([action])
}

model EmailTemplate {
  id        String   @id @default(uuid())
  name      String   @unique
  subject   String
  body      String
  variables Json?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WhatsAppTemplate {
  id        String   @id @default(uuid())
  name      String   @unique
  body      String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum VendorVerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum InquiryStatus {
  PENDING
  CONTACTED
  CLOSED
}

enum FuelType {
  PETROL
  DIESEL
  ELECTRIC
  HYBRID
  CNG
}

enum Transmission {
  MANUAL
  AUTOMATIC
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum VehicleStatus {
  DRAFT
  PUBLISHED
}

enum RegistrationStatus {
  NOT_REGISTERED
  FORM_SUBMITTED
  ACCOUNT_CREATED
  EMAIL_SENT
  ACTIVE
  SUSPENDED
}

enum DriverOption {
  WITH_DRIVER
  WITHOUT_DRIVER
  BOTH
}
